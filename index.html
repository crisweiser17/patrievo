<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evolução Patrimonial</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">📈 Evolução Patrimonial</h1>
            <p class="text-gray-600">Acompanhe sua evolução financeira mensal</p>
        </header>

        <!-- Controles de Mês/Ano -->
        <div class="mb-6 bg-white p-4 rounded-lg shadow">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <label class="text-sm font-medium text-gray-700">Mês/Ano:</label>
                    <div class="flex items-center gap-2">
                        <select id="mesSelect" class="border border-gray-300 rounded px-3 py-2"></select>
                        <select id="anoSelect" class="border border-gray-300 rounded px-3 py-2"></select>
                        <!-- Hidden para compatibilidade com a lógica existente -->
                        <input type="month" id="mesAno" class="hidden">

                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <span class="text-sm text-gray-600">Cotação USD/BRL:</span>
                    <span id="cotacaoDolar" class="font-semibold text-green-600">Carregando...</span>
                </div>
            </div>
        </div>

        <!-- Resumo Patrimonial -->
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-6">
            <!-- Card Renda Total -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">💰 Renda Total 
                    <span class="tooltip-container">
                        <span class="tooltip-icon text-xs text-gray-500">ⓘ</span>
                        <span class="tooltip-text">
                            <strong>Renda Total</strong><br>
                            Soma de todas as receitas do mês, incluindo:<br>
                            • Salários<br>
                            • Rendas de investimentos<br>
                            • Outras fontes<br><br>
                            <strong>Cálculo:</strong> ∑ Receitas
                        </span>
                    </span>
                </h3>
                <div class="text-2xl font-bold text-green-600" id="rendaTotal">R$ 0,00</div>
                <div class="text-sm text-gray-600 mt-2">
                    <div>Alta confiabilidade: <span id="rendaAltaConf">R$ 0,00</span></div>
                    <div>Baixa confiabilidade: <span id="rendaBaixaConf">R$ 0,00</span></div>
                    <div>Renda independente: <span id="rendaIndependente">R$ 0,00</span></div>
                </div>
            </div>

            <!-- Card Custos -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">💸 Custos Totais 
                    <span class="tooltip-container">
                        <span class="tooltip-icon text-xs text-gray-500">ⓘ</span>
                        <span class="tooltip-text">
                            <strong>Custos Totais</strong><br>
                            Soma de todos os gastos do mês, organizados por centros de custo.<br><br>
                            <strong>Cálculo:</strong> ∑ Custos
                        </span>
                    </span>
                </h3>
                <div class="text-2xl font-bold text-red-600" id="custosTotais">R$ 0,00</div>
                <div class="text-sm text-gray-600 mt-2" id="breakdownCustos"></div>
            </div>

            <!-- Card Patrimônio -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">🏦 Patrimônio 
                    <span class="tooltip-container">
                        <span class="tooltip-icon text-xs text-gray-500">ⓘ</span>
                        <span class="tooltip-text">
                            <strong>Patrimônio Líquido Total</strong><br>
                            Soma dos ativos e investimentos menos os passivos.<br><br>
                            <strong>Cálculo:</strong><br>
                            Ativos + Investimentos - Passivos
                        </span>
                    </span>
                </h3>
                <div class="text-2xl font-bold text-blue-600" id="patrimonioTotal">R$ 0,00</div>
                <div class="text-sm text-gray-600 mt-2">
                    <div>Investimentos: <span id="investimentosTotal">R$ 0,00</span></div>
                    <div>Ativos: <span id="ativosTotal">R$ 0,00</span></div>
                    <div>Passivos: <span id="passivosTotal">R$ 0,00</span></div>
                </div>
            </div>

            <!-- Card Insights -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">🧠 Insights 
                    <span class="tooltip-container">
                        <span class="tooltip-icon text-xs text-gray-500">ⓘ</span>
                        <span class="tooltip-text">
                            <strong>Insights Financeiros</strong><br>
                            Resumo dos principais indicadores do mês:<br>
                            • Rendas totais<br>
                            • Custos totais<br>
                            • Renda disponível<br>
                            • Métricas de independência financeira
                        </span>
                    </span> 
                    <a href="#" id="linkEvolucaoFinanceira" class="ml-2 text-blue-600 hover:underline" title="Abrir Evolução Financeira">📈</a>
                </h3>
                <div class="text-sm text-gray-600">
                    <div>💰 Renda Total: <span id="insightsRendaTotal">R$ 0,00</span></div>
                    <div>💸 Custos Totais: <span id="insightsCustosTotais">R$ 0,00</span></div>
                    <div>🟢 Renda Disponível: <span id="insightsRendaDisponivel">R$ 0,00</span></div>
                    <div>📈 Renda de Investimentos: <span id="rendaInvestimentos">R$ 0,00</span></div>
                    <div>🏖️ Renda Sem Emprego: <span id="rendaSemEmprego">R$ 0,00</span></div>
                </div>
            </div>
        </div>

        <!-- Abas principais -->
        <div class="bg-white rounded-lg shadow mb-6">
            <div class="border-b">
                <nav class="flex -mb-px">
                    <button class="tab-button active px-6 py-3 text-sm font-medium text-blue-600 border-b-2 border-blue-600" data-tab="receitas">
                        📥 Receitas
                    </button>
                    <button class="tab-button px-6 py-3 text-sm font-medium text-gray-500 hover:text-gray-700 border-b-2 border-transparent" data-tab="custos">
                        💸 Custos
                    </button>
                    <button class="tab-button px-6 py-3 text-sm font-medium text-gray-500 hover:text-gray-700 border-b-2 border-transparent" data-tab="investimentos">
                        📊 Investimentos
                    </button>
                    <button class="tab-button px-6 py-3 text-sm font-medium text-gray-500 hover:text-gray-700 border-b-2 border-transparent" data-tab="ativos-passivos">
                        🏠 Ativos & Passivos
                    </button>
                </nav>
            </div>

            <!-- Conteúdo das abas -->
            <div class="p-6">
                <!-- Aba Receitas -->
                <div id="receitas" class="tab-content active">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold">Receitas</h2>
                        <div class="flex items-center gap-2">
                            <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700" onclick="abrirModalReceita()">
                                + Nova Receita
                            </button>
                            <button class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700" onclick="copiarReceitasMesAnterior()">
                                📋 Copiar Mês Anterior
                            </button>
                            <button class="px-3 py-2 rounded border border-gray-300 bg-white text-gray-700 hover:bg-gray-100 shadow-sm" title="Gerir categorias" aria-label="Gerir categorias" onclick="abrirModalCategoriasReceita()">⚙️</button>
                        </div>
                    </div>
                    <div id="listaReceitas" class="space-y-3"></div>
                    <div class="mt-4 pt-4 border-t">
                        <div class="flex justify-between text-lg font-semibold">
                            <span>Total:</span>
                            <span id="totalReceitas">R$ 0,00</span>
                        </div>
                    </div>
                    
                    <!-- Gráfico de Evolução de Receitas -->
                    <div class="mt-6 bg-gray-50 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold mb-4">📊 Evolução de Receitas (12 meses)</h3>
                        <div class="relative h-64">
                            <canvas id="graficoReceitas" class="w-full h-full"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Aba Custos -->
                <div id="custos" class="tab-content hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold">Custos</h2>
                        <div class="flex items-center gap-2">
                            <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700" onclick="abrirModalCusto()">
                                + Novo Custo
                            </button>
                            <button class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700" onclick="copiarCustosMesAnterior()">
                                📋 Copiar Mês Anterior
                            </button>
                            <button class="px-3 py-2 rounded border border-gray-300 bg-white text-gray-700 hover:bg-gray-100 shadow-sm" title="Gerir centros de custos" aria-label="Gerir centros de custos" onclick="abrirModalCentrosCusto()">⚙️</button>
                        </div>
                    </div>
                    <div id="listaCustos" class="space-y-3"></div>
                    <div class="mt-4 pt-4 border-t">
                        <div class="flex justify-between text-lg font-semibold">
                            <span>Total:</span>
                            <span id="totalCustos">R$ 0,00</span>
                        </div>
                    </div>
                    
                    <!-- Gráfico de Evolução de Custos -->
                    <div class="mt-6 bg-gray-50 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold mb-4">📊 Evolução de Custos (12 meses)</h3>
                        <div class="relative h-64">
                            <canvas id="graficoCustos" class="w-full h-full"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Aba Investimentos -->
                <div id="investimentos" class="tab-content hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold">Investimentos</h2>
                        <div class="flex items-center gap-2">
                            <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700" onclick="abrirModalInvestimento()">
                                + Novo Investimento
                            </button>
                            <button class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700" onclick="copiarInvestimentosMesAnterior()">
                                📋 Copiar Mês Anterior
                            </button>
                        </div>
                    </div>
                    <div id="listaInvestimentos"></div>
                    <div class="mt-4 pt-4 border-t grid grid-cols-2 gap-4">
                        <div>
                            <div class="text-sm text-gray-600">Soma Saldos BRL: <span id="somaSaldosBRL" class="font-semibold">R$ 0,00</span></div>
                            <div class="text-sm text-gray-600">Soma Saldos USD: <span id="somaSaldosUSD" class="font-semibold">$ 0,00</span></div>
                            <div class="text-sm text-gray-600">Soma Total: <span id="somaTotal" class="font-semibold">R$ 0,00</span></div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-600">Soma Rendimentos: <span id="somaRendimentos" class="font-semibold">R$ 0,00</span></div>
                            <div class="text-sm text-gray-600">Média % Rendimentos: <span id="mediaRendimentos" class="font-semibold">0.00%</span></div>
                        </div>
                    </div>
                    
                    <!-- Gráfico de Evolução Patrimonial (apenas para Investimentos) -->
                    <div class="mt-6 bg-gray-50 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold mb-4">📈 Evolução Patrimonial</h3>
                        <div class="relative h-64">
                            <canvas id="graficoEvolucao" class="w-full h-full"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Aba Ativos & Passivos -->
                <div id="ativos-passivos" class="tab-content hidden">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Ativos -->
                        <div>
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-xl font-semibold">Ativos</h2>
                                <div class="flex items-center gap-2">
                                    <button class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700" onclick="abrirModalAtivo()">
                                        + Novo Ativo
                                    </button>
                                    <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700" onclick="copiarAtivosMesAnterior()">
                                        📋 Copiar Mês Anterior
                                    </button>
                                </div>
                            </div>
                            <div id="listaAtivos" class="space-y-3"></div>
                            <div class="mt-4 pt-4 border-t">
                                <div class="flex justify-between text-lg font-semibold">
                                    <span>Total Ativos:</span>
                                    <span id="totalAtivos" class="text-green-600">R$ 0,00</span>
                                </div>
                            </div>
                        </div>

                        <!-- Passivos -->
                        <div>
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-xl font-semibold">Passivos</h2>
                                <div class="flex items-center gap-2">
                                    <button class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700" onclick="abrirModalPassivo()">
                                        + Novo Passivo
                                    </button>
                                    <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700" onclick="copiarPassivosMesAnterior()">
                                        📋 Copiar Mês Anterior
                                    </button>
                                </div>
                            </div>
                            <div id="listaPassivos" class="space-y-3"></div>
                            <div class="mt-4 pt-4 border-t">
                                <div class="flex justify-between text-lg font-semibold">
                                    <span>Total Passivos:</span>
                                    <span id="totalPassivos" class="text-red-600">R$ 0,00</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Gráfico de Ativos e Passivos -->
                    <div class="mt-6 bg-gray-50 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold mb-4">📊 Evolução de Ativos e Passivos (12 meses)</h3>
                        <div class="relative h-64">
                            <canvas id="graficoAtivosPassivos" class="w-full h-full"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modais -->
    <div id="modalOverlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-start sm:items-center justify-center p-4">
        <div id="modalContent" class="bg-white rounded-lg p-4 sm:p-5 w-full max-w-lg sm:max-w-xl lg:max-w-2xl max-h-[80vh] overflow-y-auto">
            <!-- Conteúdo dos modais será injetado aqui -->
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>